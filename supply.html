<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì• –ü—Ä–∏–µ–º–∫–∞ –¢–æ–≤–∞—Ä–∞ | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ü–æ—Å—Ç–∞–≤–æ–∫</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .card-header-success { background-color: #28a745; color: white; }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">
            <i class="bi bi-house-door-fill me-2"></i>Hotel Supply Automation
        </a>
    </div>
</nav>

<div class="container mt-5">
    <header class="mb-5">
        <h1 class="display-6 fw-bold text-dark">üöö –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ù–æ–≤–æ–π –ü–æ—Å—Ç–∞–≤–∫–∏</h1>
        <p class="lead text-muted">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É, —á—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å —Ç–æ–≤–∞—Ä –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∞—Å—ã –Ω–∞ —Å–∫–ª–∞–¥–µ.</p>
    </header>

    <div class="card shadow-lg mb-5">
        <div class="card-header card-header-success fw-bold">
            <i class="bi bi-box-seam me-2"></i> –î–∞–Ω–Ω—ã–µ –æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏
        </div>
        <div class="card-body">
            <form id="supplyForm">
                <div class="row g-3">
                    <div class="col-md-6 mb-3">
                        <label for="supplyProduct" class="form-label fw-bold">–¢–æ–≤–∞—Ä</label>
                        <select id="supplyProduct" class="form-select" required></select>
                        <div class="form-text text-muted">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç—É–ø–∏–ª.</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="supplySupplier" class="form-label fw-bold">–ü–æ—Å—Ç–∞–≤—â–∏–∫</label>
                        <select id="supplySupplier" class="form-select" required></select>
                        <div class="form-text text-muted">–í—ã–±–µ—Ä–∏—Ç–µ, –æ—Ç –∫–æ–≥–æ –ø–æ—Å—Ç—É–ø–∏–ª —Ç–æ–≤–∞—Ä.</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="supplyQty" class="form-label fw-bold">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç/–∫–≥)</label>
                        <input type="number" id="supplyQty" class="form-control" min="1" required>
                    </div>
                    <div class="col-md-8 mb-3">
                        <label for="supplyDate" class="form-label fw-bold">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∫–∏</label>
                        <input type="datetime-local" id="supplyDate" class="form-control" required>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success btn-lg mt-3 w-100">
                    <i class="bi bi-check-circle-fill me-2"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–∫–ª–∞–¥
                </button>
            </form>
        </div>
    </div>

    <div class="card shadow-lg">
        <div class="card-header bg-secondary text-white fw-bold">
            <i class="bi bi-clock-history me-2"></i> –ñ—É—Ä–Ω–∞–ª –ø–æ—Å—Ç–∞–≤–æ–∫ (–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π)
        </div>
        <div class="card-body">
            <table id="suppliesTable" class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col">–¢–æ–≤–∞—Ä</th>
                        <th scope="col">–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                        <th scope="col" class="text-center">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                        <th scope="col">–î–∞—Ç–∞ –∏ –í—Ä–µ–º—è</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// --- –•–µ–ª–ø–µ—Ä—ã LocalStorage ---
const STORAGE_KEY_PRODUCTS = "products";
const STORAGE_KEY_SUPPLIERS = "suppliers";
const STORAGE_KEY_SUPPLIES = "supplies";

function getProducts() { return JSON.parse(localStorage.getItem(STORAGE_KEY_PRODUCTS) || "[]"); }
function setProducts(arr) { localStorage.setItem(STORAGE_KEY_PRODUCTS, JSON.stringify(arr)); }
function getSuppliers() { return JSON.parse(localStorage.getItem(STORAGE_KEY_SUPPLIERS) || "[]"); }
function getSupplies() { return JSON.parse(localStorage.getItem(STORAGE_KEY_SUPPLIES) || "[]"); }
function saveSupplies(arr) { localStorage.setItem(STORAGE_KEY_SUPPLIES, JSON.stringify(arr)); }

// --- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –õ–æ–≥–∏–∫–∞: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ó–∞–ø–∞—Å–æ–≤ ---
function updateProductStock(productName, quantity) {
    let products = getProducts();
    let productIndex = products.findIndex(p => p.name === productName);
    
    if (productIndex !== -1) {
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ
        products[productIndex].qty += quantity;
        setProducts(products);
        console.log(`–ó–∞–ø–∞—Å —Ç–æ–≤–∞—Ä–∞ ${productName} —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ ${quantity}.`);
    } else {
        // –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –∫–∞–∫ –Ω–æ–≤—ã–π
        products.push({ name: productName, qty: quantity });
        setProducts(products);
        console.warn(`–¢–æ–≤–∞—Ä ${productName} –Ω–µ –Ω–∞–π–¥–µ–Ω, –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ –Ω–æ–≤—ã–π.`);
    }
}

// --- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¢–∞–±–ª–∏—Ü—ã –ü–æ—Å—Ç–∞–≤–æ–∫ ---
function formatSupplyDate(isoString) {
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
    const date = new Date(isoString);
    const options = { 
        year: 'numeric', month: 'short', day: 'numeric', 
        hour: '2-digit', minute: '2-digit', 
        hour12: false 
    };
    return date.toLocaleDateString('ru-RU', options);
}

function renderSuppliesTable() {
    let tbody = document.querySelector("#suppliesTable tbody");
    tbody.innerHTML = "";
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫) –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10
    getSupplies().sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10).forEach(s => {
        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${s.product}</td>
            <td><i class="bi bi-truck-flatbed me-1"></i>${s.supplier}</td>
            <td class="text-center fw-bold text-success">+${s.qty}</td>
            <td>${formatSupplyDate(s.date)}</td>
        `;
        tbody.appendChild(tr);
    });
}

// --- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ–≤ ---
function fillSelects() {
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–ª—É—à–µ–∫, –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ suppliers.html)
    if (getProducts().length === 0) {
        setProducts([{ name: "–ú–æ–ª–æ–∫–æ 3.2%", qty: 0 }, { name: "–Ø–π—Ü–æ –°1 (—à—Ç)", qty: 0 }]);
    }
    if (getSuppliers().length === 0) {
        localStorage.setItem(STORAGE_KEY_SUPPLIERS, JSON.stringify([{ name: "–ú–æ–ª–æ—á–Ω—ã–π –î–æ–º" }, { name: "–û–≤–æ—â–Ω–æ–π –ú–∏—Ä" }]));
    }
    
    let productSelect = document.getElementById("supplyProduct");
    let supplierSelect = document.getElementById("supplySupplier");
    
    productSelect.innerHTML = "";
    supplierSelect.innerHTML = "";
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –æ–ø—à–Ω –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
    productSelect.add(new Option('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä...', '', true, true));
    supplierSelect.add(new Option('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞...', '', true, true));
    
    getProducts().forEach(p => productSelect.add(new Option(p.name, p.name)));
    getSuppliers().forEach(s => supplierSelect.add(new Option(s.name, s.name)));
}

// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –§–æ—Ä–º—ã ---
document.addEventListener("DOMContentLoaded", function(){
    fillSelects();
    renderSuppliesTable();
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
    document.getElementById('supplyDate').value = new Date(new Date().getTime() - (new Date().getTimezoneOffset() * 60000)).toISOString().slice(0, 16);
});

document.getElementById("supplyForm").addEventListener("submit", function(e){
    e.preventDefault();
    
    let product = document.getElementById("supplyProduct").value;
    let supplier = document.getElementById("supplySupplier").value;
    let qty = parseInt(document.getElementById("supplyQty").value);
    let date = document.getElementById("supplyDate").value;

    // 1. –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –æ –ø–æ—Å—Ç–∞–≤–∫–µ
    let supplies = getSupplies();
    supplies.push({product, supplier, qty, date});
    saveSupplies(supplies);

    // 2. –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø–∞—Å –Ω–∞ —Å–∫–ª–∞–¥–µ (–ö–†–ò–¢–ò–ß–ù–û)
    updateProductStock(product, qty);
    
    // 3. –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏ –æ—á–∏—â–∞–µ–º
    renderSuppliesTable();
    alert(`–ü–æ—Å—Ç–∞–≤–∫–∞ ${product} (${qty}) –æ—Ç ${supplier} —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç–∞, —Å–∫–ª–∞–¥ –æ–±–Ω–æ–≤–ª–µ–Ω!`);
    this.reset();
    // –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('supplyDate').value = new Date(new Date().getTime() - (new Date().getTimezoneOffset() * 60000)).toISOString().slice(0, 16);
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>