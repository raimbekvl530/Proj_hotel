<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¶ –°–∫–ª–∞–¥ | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ü–æ—Å—Ç–∞–≤–æ–∫</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .qty-low { color: #dc3545; font-weight: bold; } /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –Ω–∏–∑–∫–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ */
        .qty-high { color: #28a745; } /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ */
        .card-header-primary { background-color: #007bff; color: white; }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">
            <i class="bi bi-house-door-fill me-2"></i>Hotel Supply Automation
        </a>
    </div>
</nav>

<div class="container mt-5">
    <header class="mb-5">
        <h1 class="display-6 fw-bold text-dark">üì¶ –°–∫–ª–∞–¥ –∏ –¢–µ–∫—É—â–∏–µ –ó–∞–ø–∞—Å—ã</h1>
        <p class="lead text-muted">–û–±–∑–æ—Ä –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–ø–∏—Å–∞–Ω–∏—è (—Ä–∞—Å—Ö–æ–¥–∞).</p>
    </header>

    <div class="card shadow-lg mb-5">
        <div class="card-header card-header-primary fw-bold">
            <i class="bi bi-archive-fill me-2"></i> –¢–µ–∫—É—â–∏–µ –û—Å—Ç–∞—Ç–∫–∏ –ü—Ä–æ–¥—É–∫—Ç–æ–≤
        </div>
        <div class="card-body">
            <table id="productsTable" class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col">–¢–æ–≤–∞—Ä</th>
                        <th scope="col" class="text-center">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                        <th scope="col" class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>
    
    <div class="card shadow-lg">
        <div class="card-header bg-secondary text-white fw-bold">
            <i class="bi bi-clock-history me-2"></i> –ò—Å—Ç–æ—Ä–∏—è –ü–æ—Å–ª–µ–¥–Ω–∏—Ö –ü–æ—Å—Ç–∞–≤–æ–∫
        </div>
        <div class="card-body">
            <table id="suppliesTable" class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col">–¢–æ–≤–∞—Ä</th>
                        <th scope="col">–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                        <th scope="col" class="text-center">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                        <th scope="col">–î–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// --- –•–µ–ª–ø–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LocalStorage ---
const STORAGE_KEY_PRODUCTS = "products";
const STORAGE_KEY_SUPPLIES = "supplies";

function getProducts() {
    return JSON.parse(localStorage.getItem(STORAGE_KEY_PRODUCTS) || "[]");
}
function setProducts(products) {
    localStorage.setItem(STORAGE_KEY_PRODUCTS, JSON.stringify(products));
}
function getSupplies() {
    return JSON.parse(localStorage.getItem(STORAGE_KEY_SUPPLIES) || "[]");
}

// --- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –°–ø–∏—Å–∞–Ω–∏—è (–£–º–µ–Ω—å—à–µ–Ω–∏–µ –∑–∞–ø–∞—Å–∞) ---
function decreaseProductQty(productName) {
    let products = getProducts();
    let product = products.find(p => p.name === productName);
    
    if (product && product.qty > 0) {
        product.qty -= 1; // –°–ø–∏—Å—ã–≤–∞–µ–º 1 –µ–¥–∏–Ω–∏—Ü—É
        setProducts(products);
        renderProductsTable(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        alert(`–°–ø–∏—Å–∞–Ω–∞ 1 –µ–¥. —Ç–æ–≤–∞—Ä–∞: ${productName}. –¢–µ–∫—É—â–∏–π –∑–∞–ø–∞—Å: ${product.qty}`);
    } else if (product && product.qty === 0) {
        alert(`–ó–∞–ø–∞—Å —Ç–æ–≤–∞—Ä–∞ "${productName}" –∏—Å—á–µ—Ä–ø–∞–Ω.`);
    }
}

// --- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¢–∞–±–ª–∏—Ü—ã –ó–∞–ø–∞—Å–æ–≤ ---
function renderProductsTable() {
    const tbody = document.querySelector("#productsTable tbody");
    tbody.innerHTML = "";
    
    const products = getProducts();
    const MIN_STOCK = 5; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
    
    products.forEach(p => {
        const tr = document.createElement("tr");
        let qtyClass = "";
        
        if (p.qty <= 0) {
            qtyClass = "table-danger"; // –í–µ—Å—å —Ä—è–¥ –∫—Ä–∞—Å–Ω—ã–π, –µ—Å–ª–∏ –∑–∞–ø–∞—Å 0
        } else if (p.qty < MIN_STOCK) {
            qtyClass = "table-warning"; // –ñ–µ–ª—Ç—ã–π, –µ—Å–ª–∏ –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞
        }

        tr.classList.add(qtyClass);
        
        tr.innerHTML = `
            <td>${p.name}</td>
            <td class="text-center fw-bold ${p.qty < MIN_STOCK && p.qty > 0 ? 'qty-low' : (p.qty >= MIN_STOCK ? 'qty-high' : '')}">
                ${p.qty}
            </td>
            <td class="text-center">
                <button 
                    class="btn btn-sm btn-outline-danger" 
                    onclick="decreaseProductQty('${p.name}')"
                    ${p.qty <= 0 ? 'disabled' : ''}>
                    <i class="bi bi-dash-circle"></i> –°–ø–∏—Å–∞—Ç—å
                </button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// --- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¢–∞–±–ª–∏—Ü—ã –ü–æ—Å—Ç–∞–≤–æ–∫ ---
function formatSupplyDate(isoString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
    return new Date(isoString).toLocaleDateString('ru-RU', options);
}

function renderSuppliesTable() {
    const tbody = document.querySelector("#suppliesTable tbody");
    tbody.innerHTML = "";
    
    getSupplies().reverse().slice(0, 10).forEach(s => { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–æ—Å—Ç–∞–≤–æ–∫
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${s.product}</td>
            <td><i class="bi bi-truck-flatbed me-1"></i> ${s.supplier}</td>
            <td class="text-center fw-bold text-success">${s.qty}</td>
            <td>${formatSupplyDate(s.date)}</td>
        `;
        tbody.appendChild(tr);
    });
}

// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ---
document.addEventListener("DOMContentLoaded", function(){
    // –ï—Å–ª–∏ LocalStorage –ø—É—Å—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    if (getProducts().length === 0) {
        setProducts([
            { name: "–ú–æ–ª–æ–∫–æ 3.2%", qty: 15 },
            { name: "–Ø–π—Ü–æ –°1 (—à—Ç)", qty: 45 },
            { name: "–§–∏–ª–µ –∫—É—Ä–∏–Ω–æ–µ (–∫–≥)", qty: 4 },
            { name: "–ü–æ–º–∏–¥–æ—Ä—ã (–∫–≥)", qty: 0 } 
        ]);
        // –ú–æ–¥–µ–ª–∏—Ä—É–µ–º –ø–æ—Å—Ç–∞–≤–∫—É
        localStorage.setItem(STORAGE_KEY_SUPPLIES, JSON.stringify([
            { product: "–ú–æ–ª–æ–∫–æ 3.2%", supplier: "–ú–æ–ª–æ—á–Ω—ã–π –î–æ–º", qty: 20, date: new Date().toISOString() },
            { product: "–Ø–π—Ü–æ –°1 (—à—Ç)", supplier: "–ü—Ç–∏—Ü–µ—Ñ–∞–±—Ä–∏–∫–∞", qty: 50, date: new Date().toISOString() }
        ]));
    }
    
    renderProductsTable();
    renderSuppliesTable();
});
</script>

</body>
</html>